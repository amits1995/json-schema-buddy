"use strict";angular.module("schemaApp").service("Schemaservice",["$log","Schemafactory","ArrayOptions","Specification","Utility",function(n,t,i,r,u){var f=this;this.json={};this.intermediateResult=null;this.editableSchema={};this.schema={};this.JSON2Schema=function(){this.jsonString2EditableSchema();this.editableSchema2FinalSchema()};this.isValidJSON=function(n){try{angular.fromJson(n)}catch(t){return!1}return!0};this.jsonString2EditableSchema=function(){try{f.json=angular.fromJson(user_defined_options.json);f.intermediateResult=f.schema4Object(undefined,f.json);f.editableSchema=f.constructSchema(f.intermediateResult)}catch(n){}};this.editableSchema2FinalSchema=function(){f.schema=angular.copy(f.editableSchema);this.clean(f.schema)};this.clean=function(n){var e=n.__key__,t,o,r,u,i,s;for(t in n)if(typeof n[t]=="object"&&n[t]!==null){if(n[t].__removed__){delete n[t];continue}this.clean(n[t])}else{switch(String(t)){case"__required__":if(o=n[t],r=f.getSchema(n.__parent__),!r)break;o?(r.required||(r.required=[]),r.required.push(e)):r.required&&(u=r.required.indexOf(e),u>-1&&r.required.splice(u,1));break;case"uniqueItems":i=Boolean(n[t]);n[t]=i;user_defined_options.arraysVerbose||i||delete n[t];break;case"additionalItems":i=Boolean(n[t]);n[t]=i;user_defined_options.arraysVerbose||i&&delete n[t];break;case"minimum":case"maximum":case"multipleOf":i=parseInt(n[t]);n[t]=i;user_defined_options.numericVerbose||i||i==0||delete n[t];break;case"exclusiveMinimum":case"exclusiveMaximum":i=Boolean(n[t]);n[t]=i;user_defined_options.numericVerbose||i||delete n[t];break;case"name":case"title":case"description":i=String(n[t]).trim();n[t]=i;user_defined_options.metadataKeywords||i||delete n[t];break;case"additionalProperties":i=Boolean(n[t]);n[t]=i;user_defined_options.objectsVerbose||i&&delete n[t]}s=t.match(/^__.*__$/g);s&&delete n[t]}};this.schema4Object=function(n,i){var r=t.getInstance(n,i);return angular.forEach(i,function(n,i){var u=null;u=angular.isArray(n)||angular.isObject(n)?f.schema4Object(i,n):t.getInstance(i,n);r.addSubSchema(u)}),r};this.makeVerbose=function(n,t){switch(n.type){case"array":user_defined_options.arraysVerbose&&(t.minItems=1,t.uniqueItems=!1,t.additionalItems=user_defined_options.additionalItems);break;case"object":user_defined_options.objectsVerbose&&(t.additionalProperties=!0);break;case"integer":case"number":user_defined_options.numericVerbose&&(t.multipleOf=1,t.maximum=100,t.minimum=1,t.exclusiveMaximum=!1,t.exclusiveMinimum=!1);break;case"string":user_defined_options.stringsVerbose&&(t.minLength=1)}user_defined_options.metadataKeywords&&(t.title=n.title,t.description=n.description,t.name=n.name)};this.initObject=function(n,t){n.isObject()&&(t.properties={},user_defined_options.additionalProperties?user_defined_options.objectsVerbose&&(t.additionalProperties=!0):t.additionalProperties=!1)};this.initArray=function(n,t){if(n.isArray()){switch(user_defined_options.arrayOptions){case i.emptySchema:t.items={};break;case i.singleSchema:t.items={};break;case i.arraySchema:t.items=[]}user_defined_options.additionalItems?user_defined_options.arraysVerbose&&(t.additionalItems=!0):t.additionalItems=!1}};this.addDefault=function(n,t){user_defined_options.includeDefaults&&(n.isObject()||n.isArray()||(t.default=n.defaultValue))};this.addEnums=function(n,t){user_defined_options.includeEnums&&(n.isObject()||n.isArray()||(t.enum=[null],n.defaultValue&&t.enum.push(n.defaultValue)))};this.addRequired=function(n,t){t.__required__=user_defined_options.forceRequired};this.setType=function(n,t){t.type=n.type};this.constructId=function(n,t){if(user_defined_options.absoluteIds)if(n.root)t.id=user_defined_options.url;else{var i=n.parent.id+"/"+n.id;t.id=i;n.id=i}else t.id=n.root?"/":n.id;t.__key__=n.key};this.setSchemaRef=function(n,t){n.root&&(t._$schema=r,t.__root__=!0)};this.constructSchema=function(n){var t={};return f.setSchemaRef(n,t),f.constructId(n,t),f.setType(n,t),f.makeVerbose(n,t),f.addDefault(n,t),f.addEnums(n,t),f.addRequired(n,t),f.initObject(n,t),f.initArray(n,t),angular.forEach(n.subSchemas,function(r){var e=f.constructSchema(r);if(e.__parent__=t.id,n.isObject())t.properties[r.key]=e;else if(n.isArray())switch(user_defined_options.arrayOptions){case i.emptySchema:t.items=u.getEmptySchema();break;case i.singleSchema:t.items=e;break;case i.arraySchema:n.subSchemas.length>1?t.items.push(e):t.items=e}}),t};this.removeSchemaById=function(n,t){for(var i in n){typeof n[i]=="object"&&n[i]!==null&&this.removeSchemaById(n[i],t);switch(String(i)){case"id":n[i]==t&&(n.__removed__=!0)}}};this.getSchemaById=function(n,t){var i,r;for(i in n){if(typeof n[i]=="object"&&n[i]!==null&&(r=this.getSchemaById(n[i],t),r!=null))return r;switch(String(i)){case"id":if(n[i]==t)return n}}};this.removeSchema=function(n){this.removeSchemaById(f.editableSchema,n)};this.getSchema=function(n){return this.getSchemaById(f.schema,n)};this.getEditableSchema=function(){return f.editableSchema};this.formatJSON=function(n){return angular.toJson(angular.fromJson(n),!0)};this.getFormattedJSON=function(){return angular.toJson(f.json,!0)};this.getSchemaAsString=function(n){this.editableSchema2FinalSchema();var t=angular.toJson(f.schema,n);return t.replace("_$","$")}}]);
//# sourceMappingURL=Schemaservice.min.js.map
